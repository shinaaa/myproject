$(document).ready(function(){var fuc={};fuc.init=function(){fuc.detailsAddCart();fuc.suspensionShow();fuc.detailsSusAddCart();fuc.detailIconAddCart();fuc.detailsScroll();fuc.markupV2();fuc.markupPrice();fuc.noticeDisplay();fuc.topBannerPlace();};fuc.detailesHight=function(){var detailesLeftHeight=$('.details-content-left').height();var detailesRightHeight=$('.outer-box').height()+72;$('.details-content-right').css('height',detailesRightHeight);if(detailesLeftHeight<detailesRightHeight){$('.details-content-left').css('height',detailesRightHeight);}else{$('.details-content-right').css('height',detailesLeftHeight);}};fuc.detailsAddCart=function(){};fuc.detailsSusAddCart=function(){$("#susAddCart").on('click',function(){fuc.addCart();});};fuc.detailIconAddCart=function(){$(".add-cart").on('click',function(){fuc.addCart();});};fuc.addCart=function(){var $btn=$('div.details-button a.details-but-cart');if($btn.size()>0){location.href=$btn.attr('href');return;}
var form={};if($('.details-markup').size()>=1&&$('.details-markup a.active').size()>=1){form.mainGoods={};form.markupGoods=new Array(0);form.mainGoods.goodsId=$('input[name=markUpDoodsId]').val();form.mainGoods.productId=$('input[name=productId]').val();form.mainGoods.quantity=1;$('.details-markup a.active').each(function(){var product={};product.goodsId=$(this).data('goods');product.productId=$(this).data('productid');product.quantity=1;form.markupGoods.push(product);})
addCartTrack(form.mainGoods.productId);addCartBottom('/cart-add-markupgoods.do')}else{form.productId=$('input[name=productId]').val();form.quantity=1;addCartTrack(form.productId);addCartBottom('/cart-add-goods.do')}
function addCartBottom(url){$.post(url,form,function(res){if(res.status!=='ok'){popUpWindow({title:res.message,popType:2});return false;}
$(".J-suspension-list").stop().slideUp(200);$(".product-price.can-drop").unbind('mouseover');$(".nav-addcart").stop().slideDown(200);fuc.susWicketHide();},'json');}};fuc.navScroll=function(){var scrollHight=$('.details-introduction').offset().top;if($(window).scrollTop()>=scrollHight-120){$('.header').hide();$('.suspension-box').show();}else{$(".header").show();$('.suspension-box').hide();}};fuc.detailsScroll=function(){fuc.navScroll();$(window).on('scroll',function(){fuc.navScroll();});};fuc.wicketHide=function(){setTimeout(function(){$('.addcart-dialog').hide();},3000);};fuc.susWicketHide=function(){setTimeout(function(){$(".nav-addcart").slideUp(200);fuc.suspensionShow();fuc.detailsSusAddCart();fuc.detailIconAddCart();fuc.detailsScroll();},3000);};fuc.suspensionShow=function(){$(".product-price.can-drop").on('mouseover',function(){$(".J-suspension-list").stop().slideDown(200);});$(".J-suspension-list").mouseleave(function(){$(".J-suspension-list").stop().slideUp(200);});};fuc.suspensionHide=function(){$(".product-price").unbind('mouseover');};fuc.calPrice=function(singleNormalLowerPrice,singleNormalHighPrice,singleDiscountLowerPrice,singleDiscountHighPrice,totalNormalLowPrice,totalNormalHighPrice,totalDiscountLowPrice,totalDiscountHighPrice,flag){if(flag){totalDiscountLowPrice+=singleDiscountLowerPrice;totalNormalLowPrice+=singleNormalLowerPrice;}else{totalDiscountLowPrice-=singleDiscountLowerPrice;totalNormalLowPrice-=singleNormalLowerPrice;}
$('.data-discount-high-price').text(totalDiscountHighPrice.toFixed(2));$('.data-discount-lower-price').text(totalDiscountLowPrice.toFixed(2));$('.data-normal-lower-price').text(totalNormalLowPrice.toFixed(2));$('.data-normal-high-price').text(totalNormalHighPrice.toFixed(2));$('#dataMinZprice').text(totalDiscountLowPrice.toFixed(2));$('#dataMaxZprice').text(totalDiscountHighPrice.toFixed(2));$('#dataMinPrice').text(totalNormalLowPrice.toFixed(2));$('#dataMaxPrice').text(totalNormalHighPrice.toFixed(2));};fuc.markupV2=function(){$('.details-markup a').click(function(){if($(this).hasClass('active')){$(this).removeClass('active')}else{$(this).addClass('active')}
var price=0;var name='';if($('.details-markup a.active').size()>=1){$('.details-markup a.active').each(function(index,val){price+=parseInt($(this).data('price'))
if(index>=1){name+='和'+$(this).data('name')}else{name+=$(this).data('name')}});$('.markup-text').show();$('.markup-text .price').text(price)
$('.markup-text .name').text(name)}else{$('.markup-text').hide();}})};fuc.markupPrice=function(){$.ajaxSetup({async:false});$('.markup-selse-content>i').on('click',function(){$('#markupSelsePop').hide();});$('#markupPrice .right-price-pro li').each(function(){var this_=$(this);var proI=$('i',this);var this_=$(this);var goodsId=this_.attr('goods-id');var selectLi=$('.markupSelect li[goods-id='+goodsId+']');var dataDiscountLowerPrice=parseFloat($(this).attr('data-discount-lower-price'));var dataDiscountHighPrice=parseFloat($(this).attr('data-discount-High-price'));var dataNormalLowerPrice=parseFloat($(this).attr('data-normal-lower-price'));var dataNormalHighPrice=parseFloat($(this).attr('data-normal-High-price'));if($(this).hasClass('active')){$('#markupProList li[goods-id='+goodsId+']').show();}
proI.on('click',function(){var totalDiscountLowPrice=parseFloat($('.data-discount-lower-price').text());var totalDiscountHighPrice=parseFloat($('.data-discount-high-price').text());var DiscountLowPrice=parseFloat($('.data-normal-lower-price').text());var DiscountHighPrice=parseFloat($('.data-normal-high-price').text());selectLi.toggleClass('active');$('#markupProList li[goods-id='+goodsId+']').toggle();var flag=this_.hasClass('active');fuc.calPrice(dataNormalLowerPrice,dataNormalHighPrice,dataDiscountLowerPrice,dataDiscountHighPrice,DiscountLowPrice,DiscountHighPrice,totalDiscountLowPrice,totalDiscountHighPrice,flag);});});$('.listBox').on('click','li',function(){var lowerPrice=parseFloat($('.data-discount-lower-price').text());var discountLowerPrice=parseFloat($('.left-price-pro .first-a').text());var productid=parseInt($(this).attr('data-productid'));var goodsid=$(this).parents('div.listBox ul').attr('goods-id');var price=parseFloat($(this).attr('data-discount-price'));$(this).addClass('active').siblings('li').removeClass('active');$('.markupAddCart[goods-id='+goodsid+']').attr('data-productid',productid);$("#popMarkup p.price-p").text('组合价：￥'+(lowerPrice+price-discountLowerPrice).toFixed(2));});$('.top-right-img-list i').on('click',function(){$(this).toggleClass('active');});$('.price-text-list').each(function(){var firstA=parseInt($('.first-a',this).text());var lastA=parseInt($('.last-a',this).text());if(firstA==lastA){$(this).text('￥'+firstA.toFixed(2));}});fuc.markupPriceanmate($('#markupPrice'),203);fuc.markupPriceanmate($('#markupSelsePop'),119);fuc.markupSelect();};fuc.markupList=function(){$('#markupProList>li:visible:even').css('clear','left');$('#markupProList>li:visible:odd').css('clear','none');};fuc.markupSelect=function(){var markupProList=$('#markupProList');$('#markupAdd').on('click',function(){var markupSelectList=$('#markupPrice .active');var i=0;var firstP;var lastP;var name;var goodsid;var html='';markupSelectList.each(function(index,el){var size=$(this).next('.markupgoodsList').find('li').size();if(size>=2){i+=1;html=$(this).next('.markupgoodsList').html();firstP=$('.data-discount-lower-price').text();lastP=$('.data-discount-high-price').text();name=$(this).attr('data-name');goodsid=$(this).attr('goods-id');}});if(i==1){$('#popMarkup').find('.listBox ul').html(html).attr('goods-id',goodsid);$('#popMarkup').find('.price-p').html('组合价：￥<a class="first-a">'+firstP+'</a>-<a class="last-a">'+lastP+'</a>');$('#popMarkup').find('.select-p span').text(name);$('#popMarkup').show();$('#hideDiv').show();$('#cancelSelect').on('click',function(){$('#popMarkup').hide();$('#hideDiv').hide();});$('#assignButton').unbind('click').on('click',function(){var size=$('.listBox li.active').size();if(size>=1){var activeList=$('#markupPrice');fuc.markupAddCart(activeList);}else{alert('请选择规格！')}});}else if(i==0){var activeList=$('#markupPrice');fuc.markupAddCart(activeList);}else{$('#markupSelsePop').show();fuc.markupSelectAddCart();fuc.markupList();}});var markupSelectListLi=$('#markupSelectList li');markupSelectListLi.each(function(index,el){var activeI=$('i',this);var this_=$(this);var goodsid=$(this).attr('goods-id');var markProLi=$('#markupProList>li[goods-id='+goodsid+'] li');var dataDiscountLowerPrice=parseFloat($(this).attr('data-discount-lower-price'));var dataDiscountHighPrice=parseFloat($(this).attr('data-discount-High-price'));var dataNormalLowerPrice=parseFloat($(this).attr('data-normal-lower-price'));var dataNormalHighPrice=parseFloat($(this).attr('data-normal-High-price'));activeI.on('click',function(){var goodsId=this_.attr('goods-id');var markupLi=markupProList.find('li[goods-id='+goodsId+']');var markupLiSelect=$('.markupSelect li[goods-id='+goodsId+']');var DiscountLowPrice=parseFloat($('#dataMinPrice').text());var DiscountHighPrice=parseFloat($('#dataMaxPrice').text());var totalDiscountLowPrice=parseFloat($('#dataMinZprice').text());var totalDiscountHighPrice=parseFloat($('#dataMaxZprice').text());markupLiSelect.toggleClass('active');var flag=this_.hasClass('active');if(this_.hasClass('active')&&markProLi.size()<=1){markProLi.first().trigger('click');}
else if(!this_.hasClass('active')&&markProLi.hasClass('active')){var p=parseFloat($('#amountPrice a').text())-parseFloat($('#markupProList>li[goods-id='+goodsid+'] li.active').attr('data-discount-price'));$('#amountPrice a').text(p.toFixed(2));}else if(this_.hasClass('active')&&markProLi.hasClass('active')){$('#markupProList>li[goods-id='+goodsid+'] li.active').trigger('click');}
markupLi.toggle();fuc.markupList();fuc.calMarkPrice();})});};fuc.calMarkPrice=function(){var minPrice=0;var maxPrice=0;var NormalMinPrice=0;var NormalMaxPrice=0;$('#markupProList>li:visible').each(function(){var this_=$(this);var ulList=$('ul',this);var liPro=ulList.find('li');var activeLipro=ulList.find('li.active');if(activeLipro.size()>=1){minPrice+=parseFloat(activeLipro.attr('data-discount-price'));maxPrice+=parseFloat(activeLipro.attr('data-discount-price'));NormalMinPrice+=parseFloat(activeLipro.attr('data-price'));NormalMaxPrice+=parseFloat(activeLipro.attr('data-price'));}else{minPrice+=parseFloat(liPro.first().attr('data-discount-price'));maxPrice+=parseFloat(liPro.last().attr('data-discount-price'));NormalMinPrice+=parseFloat(liPro.first().attr('data-price'));NormalMaxPrice+=parseFloat(liPro.last().attr('data-price'));}});$('#dataMinZprice').text(minPrice.toFixed(2));$('#dataMaxZprice').text(maxPrice.toFixed(2));$('#dataMinPrice').text(NormalMinPrice.toFixed(2));$('#dataMaxPrice').text(NormalMaxPrice.toFixed(2));}
fuc.markupSelectAddCart=function(){var p=parseFloat($('#amountPrice a').text());$('.mainGoodsId .dataMinPrice,.mainGoodsId .dataMinZprice').val(0);$('#markupProList>li').each(function(){var actList=$('ul.bottom-list-details',this).find('li');var goodsid=$(this).attr('goods-id');var singleDiscountLowerPrice=parseFloat($(this).attr('data-discount-lower-price'));var singleDiscountHighPrice=parseFloat($(this).attr('data-discount-High-price'));var singleNormalLowerPrice=parseFloat($(this).attr('data-normal-lower-price'));var singleNormalHighPrice=parseFloat($(this).attr('data-normal-High-price'));var totalNormalLowPrice=parseFloat($('#dataMinPrice').text());var totalNormalHighPrice=parseFloat($('#dataMaxPrice').text());var totalDiscountLowPrice=parseFloat($('#dataMinZprice').text());var totalDiscountHighPrice=parseFloat($('#dataMaxZprice').text());actList.unbind('click').on('click',function(){if($(this).parent('ul').find('li').hasClass('active')){var priceActive=parseInt($(this).parent('ul').find('li.active').attr('data-discount-price'));}else{var priceActive=0;}
$(this).addClass('active').siblings('li').removeClass('active');var productid=$(this).attr('data-productid');var discountPrice=parseInt($(this).attr('data-discount-price'));p=p-priceActive+discountPrice;$('#amountPrice a').text(p.toFixed(2));$('.mark-addlist[goods-id='+goodsid+']').attr('data-productid',productid);fuc.calMarkPrice();});if($('#markupSelectList li[goods-id='+goodsid+']').hasClass('active')&&actList.size()<=1){$('ul.bottom-list-details',this).find('li').trigger('click');}});$('.mainGoodsId #markupPro li').first().trigger('click');$('#markupPopAddCart').unbind('click').on('click',function(){var addCart=true;var markupPopAddCartlist=$('#markupSelsePop .mark-addlist.active');var markupPopAddCart=$('#markupSelsePop');markupPopAddCartlist.each(function(){if(!$(this).attr('data-productid')){addCart=false;alert('请选择规格！');return false;}});addCart&&fuc.markupAddCart(markupPopAddCart);})};fuc.markupAddCart=function(select){var form={};form.mainGoods={};form.markupGoods=new Array(0);var mainGoodsProductId=select.find('.mainGoodsSelected').attr('data-productid');var mainGoodsGoodsId=select.find('.mainGoodsSelected').attr('goods-id');var mainGoodsQuantity=1;form.mainGoods.goodsId=mainGoodsGoodsId;form.mainGoods.productId=mainGoodsProductId;form.mainGoods.quantity=mainGoodsQuantity;select.find('.proList .markupSelect>li.active').each(function(index,el){var product={};product.goodsId=$(this).attr('goods-id');product.productId=$(this).attr('data-productid');product.quantity=1;form.markupGoods.push(product);});$.post('/cart-add-markupgoods.do',form,function(res){if(res.status!=='ok'){popUpWindow({title:res.message,popType:2});return false;}else{popUpWindow({title:'加入购物车成功！',popType:2});}});window.cartAmount();$('#popMarkup').hide();$('#hideDiv').hide();$('#markupSelsePop').hide();};fuc.markupPriceanmate=function(s,h){var markupSelectHeight=s.find('.markupSelect').height();if(markupSelectHeight>h){var i=0;var a=-(markupSelectHeight-h);s.find('.switch-box').show();s.find('.bottom-button').on('click',function(){s.find('.top-button').addClass('active');var b=s.find('.markupSelect').position().top;if(b>a){i++;s.find('.markupSelect').animate({top:-i*h},500,function(){var b=s.find('.markupSelect').position().top;if(b==a){s.find('.bottom-button').addClass('active')}});}});s.find('.top-button').on('click',function(){var b=s.find('.markupSelect').position().top;s.find('.bottom-button').removeClass('active');if(b!=0){i--;s.find('.markupSelect').animate({top:-i*h},500,function(){var b=s.find('.markupSelect').position().top;if(b==0){s.find('.top-button').removeClass('active');}});}});}};fuc.noticeDisplay=function(){var form2={};form2.type='notice';form2.position='goods';form2.channel='pc';api.getJsonp('Notice.show','1.0',form2,function(res){if(res.status=='ok'){var data=res.data;if(data.hasOwnProperty('notice')&&data['notice'].length>0){var html='';$.each(data.notice,function(index,val){if(this.image!==''){html+='<li><p><img src="'+this.image+'" /><span>'+this.title+'</span>'}else{html+='<li><p><img src="/themes/site/img/notic.png"/><span>'+this.title+'</span>'}
if(this.link==''||this.subTitle==''){html+='</p></li>'}else{html+='<a href="'+this.link+'">'+this.subTitle+'>></a></p></li>'}
$('#cart-events-box').html(html);cartEvent();})}}})};fuc.topBannerPlace=function(){var form={'position':'goods_banner','channel':'pc'}
api.getJsonp('Advertisement.showV2','1.0',form,function(res){if(res.status=='ok'){if(res.data.length==0){return false;}
var urlData=res.data[0].data[0];var sWidth=$(window).width();if(sWidth<1600&&urlData.hasOwnProperty('img_url_small')&&urlData.img_url_small!==''){var html='<img src="'+Global.staticDomain+urlData.img_url_small+'"/>';}else{var html='<img src="'+Global.staticDomain+urlData.img_url+'"/>';}
$('.top-banner').attr({'href':urlData.href,'target':urlData.target}).html(html);}})};fuc.init();var detailCache={products:{},currentCity:{},isProductPage:false,cartUrl:'/cart.do',type:'normal',globalSpecImg:'',init:function(){this.isProductPage=$('input[name=isProductPage]').val();this.currentCity=cache.getCurrentCity();},getCurrentCity:function(){return this.currentCity;},setProducts:function(data){this.products=data;},getProducts:function(){return this.products;},setType:function(type){this.type=type;},getType:function(){return this.type;},setGlobalSpecImg:function(imgSrc){this.globalSpecImg=imgSrc;},getGlobalSpecImg:function(){return this.globalSpecImg;}};detailCache.init();if(detailCache.currentCity){var form={};form.cityId=detailCache.currentCity.id;form.channel='pc';form.goodsId=$('input[name=goodsId]').val();api.getJsonp('Goods.goodsDetail','1.0',form,function(res){if(res.status!=='ok'){popUpWindow({title:res.message,popType:2});return false;}
if(res.data.type=='multiply'){detailCache.setType('multiply');goods.specHtmlMultiply(res.data);}else{detailCache.setType('normal');goods.specHtmlNormal(res.data);}},'json');form={};form.cityId=detailCache.currentCity.id;form.channel='pc';form.position='goods_detail_bottom';form.goodsId=$('input[name=goodsId]').val();api.getJsonp('Advertisement.show','1.0',form,function(res){if(res.status!=='ok'){return false;}
var html='';if(res.data.hasOwnProperty('goods_detail_bottom')){html='';for(var i in res.data.goods_detail_bottom){if(res.data.goods_detail_bottom.hasOwnProperty(i)){var goods=res.data.goods_detail_bottom[i];html+='<li>';html+='<a href="/goods-'+goods.cake_goods_id+'.html" target="_blank">';html+='<img src="'+goods.img_url+'" alt="'+goods.name+'" />';html+='<h4>'+goods.name+'</h4>';html+='<p>￥'+goods.price+'/'+goods.spec+'</p>';html+='</a>';html+='<div class="recommend-cart">';html+='<p><a href="/goods-'+goods.cake_goods_id+'.html" target="_blank">'+goods.description+'</a> </p>';html+='<button data-productid="'+goods.product_id+'"><i></i></button>';html+='</div>';html+='</li>';}}
if(html){$('.recommend-list').append(html);$('.recommend-box').show();$('.recommend-list button').click(function(event){event.stopPropagation();CAKE.cart.ajax.add($(this).data('productid'),1,function(res){var title='加入成功';if(res.status!=='ok'){title=res.message.msg;return false;}
window.cartAmount();popUpWindow({title:title,popType:2})})})}}});}
var goodsAction={addCart:null,productPrice:null,detailsPrice:null,detailsButBuy:null,detailsButCart:null,detailsEmpty:null,shipTime:null,init:function(){this.shipTime={};this.addCart=$('.add-cart');this.productPrice=$('.product-price');this.detailsPrice=$('.details-price');this.detailsButBuy=$('.details-but-buy');this.detailsButCart=$('.details-but-cart');this.detailsEmpty=$('.details-empty');},noStock:function(){this.productPrice.removeClass('can-drop');this.addCart.hide();this.detailsButBuy.hide();this.detailsButCart.hide();this.detailsEmpty.show();fuc.suspensionHide();},hasStock:function(){this.productPrice.addClass('can-drop');this.addCart.show();this.detailsButBuy.show();this.detailsButCart.show();this.detailsEmpty.hide();fuc.suspensionShow();},morePound:function(){this.addCart.hide();this.productPrice.html('');this.detailsPrice.html('');this.detailsButBuy.attr('disabled','disabled');this.detailsButCart.attr('disabled','disabled');},normalPound:function(price){this.addCart.show();this.productPrice.html(price);this.detailsPrice.html(price);this.detailsButBuy.removeAttr('disabled');this.detailsButCart.removeAttr('disabled');},redirect:function(url){var $btn=$('<a href="'+url+'" class="details-but-cart" style="color: #fff;width: 100%">立即购买</a>');$btn.appendTo($('div.details-button button').hide().parent());},setShipTime:function(i,data){this.shipTime[i]=data;},getShipTime:function(i){return this.shipTime.hasOwnProperty(i)?this.shipTime[i]:null;}};goodsAction.init();var specExtra=$('.details-Specifications-size-extra');specExtra.on('click','ul>li>a',function(){if($(this).hasClass('active')){return true;}
var name=$(this).attr('data-name');specExtra.find('a').each(function(){if(name==$(this).attr('data-name')){$(this).addClass('active');}else{$(this).removeClass('active');}});var goodsId=$('input[name=goodsId]').val();var data=JSON.parse($(this).attr('data-json'));$('input[name=markUpDoodsId]').val(data.goodsId);if(goodsId!=data.goodsId){window.location.href='/goods-'+data.goodsId+'.html';return true;}
detailCache.setGlobalSpecImg(data.imgUrl);if(data.productsArr!==undefined){goods.detail(data.productsArr);if(data.hasOwnProperty('isSpecialGoods')&&data.isSpecialGoods){$('a.add-cart, div.details-button').remove();var goodsId=$('input[name=goodsId]').val();if(goodsId==398){$('.details-distribution .distribution-time').html('<i></i><span>配送时间：</span>12时（含）及之前的订单，次日12时前发货；12时之后的订单，隔日12时前发货');}else if(goodsId==399||goodsId==401||goodsId==402){$('.details-distribution .distribution-time').html('<i></i><span>配送时间：</span>11时（含）及之前的订单，当日12时发货；11时之后的订单，次日12时发货');}}}
if(data.saleTime!==undefined){$('.details-options-time').html(goods.saleTimeHtml(data.saleTime));}});$('.details-Specifications-size').on('click','ul>li>a',function(){var productId=$(this).attr('data-productId');$('.details-Specifications-size a').each(function(){if(productId==$(this).attr('data-productId')){$(this).addClass('active');}else{$(this).removeClass('active');}});var products=detailCache.getProducts();var productPrice=$('.product-price');for(var i in products){if(!products.hasOwnProperty(i)){continue;}
var product=products[i];if(product.id==productId){$('input[name=productId]').val(productId);if(product.pound==='more'){goodsAction.morePound();}else{goodsAction.normalPound('¥<span>'+parseInt(product.price)+'</span>/'+product.spec);}
$('.details-img-box').html(goods.specHtml(product));if(product.has_stock===false){goodsAction.noStock();}else if(!productPrice.hasClass('can-drop')){goodsAction.hasStock();}
if(productId){if(!goodsAction.getShipTime(productId)){var form={};form.cityId=detailCache.currentCity.id;form.productId=productId;form.goodsId=$('input[name=goodsId]').val();api.getJsonp('Goods.shipTime','1.0',form,function(res){if(res.status!=='ok'){popUpWindow({title:res.message.msg,popType:2});return false;}
goodsAction.setShipTime(productId,res.data.shipTime)
$('.details-options-time').html(goods.saleTimeHtml(res.data.shipTime));},'json');}else{$('.details-options-time').html(goods.saleTimeHtml(goodsAction.getShipTime(productId)));}}
break;}}});$('.detailsAddCart').on('click',function(){var inCart=$('.in-cart');inCart.html(goods.cartWaitHtml()).show();var form={};var analysisForm={};analysisForm.name=$(this).attr('name');analysisForm.tag='-';analysisForm.divName=$(this).attr('name');analysisForm.url='-';analysis.action('clickbond',analysisForm);if($('.details-markup').size()>=1&&$('.details-markup a.active').size()>=1){form.mainGoods={};form.markupGoods=new Array(0);form.mainGoods.goodsId=$('input[name=markUpDoodsId]').val();form.mainGoods.productId=$('input[name=productId]').val();form.mainGoods.quantity=1;$('.details-markup a.active').each(function(){var product={};product.goodsId=$(this).data('goods');product.productId=$(this).data('productid');product.quantity=1;form.markupGoods.push(product);})
addCartTrack(form.mainGoods.productId);detailAddDoods('/cart-add-markupgoods.do')}else{form.productId=$('input[name=productId]').val();form.quantity=1;addCartTrack(form.productId);detailAddDoods('/cart-add-goods.do')}
function detailAddDoods(url){$.post(url,form,function(res){if(res.status!=='ok'){popUpWindow({title:res.message,popType:2});return false;}
window.cartAmount();inCart.html(goods.cartSuccessHtml(detailCache.cartUrl));setTimeout(function(){inCart.hide();},2000);});}});$('.details-but-buy').click(function(){var form={};var analysisForm={};analysisForm.name=$(this).attr('name');analysisForm.tag='-';analysisForm.divName=$(this).attr('name');analysisForm.url='-';analysis.action('clickbond',analysisForm);if($('.details-markup').size()>=1&&$('.details-markup a.active').size()>=1){form.mainGoods={};form.markupGoods=new Array(0);form.mainGoods.goodsId=$('input[name=markUpDoodsId]').val();form.mainGoods.productId=$('input[name=productId]').val();form.mainGoods.quantity=1;$('.details-markup a.active').each(function(){var product={};product.goodsId=$(this).data('goods');product.productId=$(this).data('productid');product.quantity=1;form.markupGoods.push(product);})
addCartTrack(form.mainGoods.productId);buyDetails('/cart-add-markupgoods.do')}else{form.productId=$('input[name=productId]').val();form.quantity=1;addCartTrack(form.productId);buyDetails('/cart-add-goods.do')}
function buyDetails(url){$.post(url,form,function(res){if(res.status!=='ok'){popUpWindow({title:res.message,popType:2});return false;}
location.href=detailCache.cartUrl;},'json');}});$('.details-button').on('click','.details-empty',function(){var dialog=$('.details-empty-dialog');if(cache.hasLogin===false){dialog.show();dialog.html('<div><div><p>先登录/注册再设置</p><a href="/passport-login.do" class="details-go-cart">去登录/注册</a></div><i></i></div><i></i>');setTimeout(function(){dialog.hide();},2000);return false;}
var form={};form.productId=$('input[name=productId]').val();if(form.productId==''){popUpWindow({title:'请选择产品！',popType:2});return false;}
var analysisForm={};analysisForm.name=$(this).attr('name');analysisForm.tag='-';analysisForm.divName=$(this).attr('name');analysisForm.url='-';analysis.action('clickbond',analysisForm);$.post('/to-notify.do',form,function(res){if(res.status!=='ok'){popUpWindow({title:res.message,popType:2});return false;}
dialog.show();if(res.data.need_login!==undefined){dialog.html('<div><div><p>先登录/注册再设置</p><a href="/passport-login.do" class="details-go-cart">去登录/注册</a></div><i></i></div><i></i>');}else{dialog.html('<div><p>到货提醒设置成功！</p></div><i></i>');}
setTimeout(function(){dialog.hide();},2000);},'json');});var goods={specHtmlNormal:function(data){if(data.hasOwnProperty('productsArr')){goods.detail(data['productsArr']);if(data.hasOwnProperty('isSpecialGoods')&&data['isSpecialGoods']){$('a.add-cart, div.details-button').remove();var goodsId=parseInt($('input[name=goodsId]').val());if(goodsId===398){$('.details-distribution .distribution-time').html('<i></i><span>配送时间：</span>12时（含）及之前的订单，次日12时前发货；12时之后的订单，隔日12时前发货');}else if(goodsId===399||goodsId===401||goodsId===402){$('.details-distribution .distribution-time').html('<i></i><span>配送时间：</span>11时（含）及之前的订单，当日12时发货；11时之后的订单，次日12时发货');}}
if(data.hasOwnProperty('isSellOut')&&data['isSellOut']){$('a.add-cart, div.details-button').remove();}}
if(data.hasOwnProperty('saleTime')){$('.details-options-time').html(goods.saleTimeHtml(data['saleTime']));}},specHtmlMultiply:function(data){var extra=$('.details-Specifications-size-extra');extra.find('dt').html(data['title']);var extraHtml='';for(var i in data['productsArr']){if(!data['productsArr'].hasOwnProperty(i)){continue;}
extraHtml+='<li><a class="goods-'+data.productsArr[i].goodsId+'" data-ident="'+data.productsArr[i].goodsId+'" data-json='+JSON.stringify(data.productsArr[i])+' data-name="'+data.productsArr[i].name+'">'+data.productsArr[i].name+'<i></i></a></li>';}
extra.find('dd>ul').html('').append(extraHtml);extra.show();var defaultGoods=this.getDefaultGoods();if(defaultGoods&&extra.find('ul>li>a.goods-'+defaultGoods).length){extra.find('ul>li>a.goods-'+defaultGoods).first().click();}else{extra.find('ul>li>a').first().click();}},saleTimeHtml:function(saleTime){return'<i></i>最早'+saleTime.date+' '+saleTime.start_time+'配送</li>'},detail:function(products){detailCache.setProducts(products);var price='';var specHtml='';var specHtmlMarkup='';var defaultPound=goods.getDefault();var productDom=$('input[name=productId]');for(var i in products){if(!products.hasOwnProperty(i)){continue;}
var product=products[i];var productPrice=$('.product-price');if((defaultPound&&product['pound']==defaultPound)||(!defaultPound&&product['is_default']==='true')){price='¥<span>'+parseInt(product['price'])+'</span>/'+product['spec'];productDom.val(product['id']);specHtml+='<li><a class="active" data-productId="'+product.id+'">'+product['spec']+'<i></i></a></li>';specHtmlMarkup+='<li data-productId="'+product.id+'">'+product['spec']+'</li>';$('.details-img').attr('src',Global.staticDomain+product['img_url']);if(!product.hasOwnProperty('redirect')||!product['redirect']){if(product['has_stock']===false){goodsAction.noStock();}else if(!productPrice.hasClass('can-drop')){goodsAction.hasStock();}
if(product['pound']==='more'){price='';goodsAction.morePound();}else{goodsAction.normalPound(price);}}else{goodsAction.redirect(product['redirect']);}
$('.details-img-box').html(goods.specHtml(product));}else{specHtml+='<li><a data-productId="'+product.id+'">'+product.spec+'<i></i></a></li>';specHtmlMarkup+='<li data-productId="'+product.id+'">'+product.spec+'</li>';}}
$('.details-price').html(price);$('.details-Specifications-size>dd>ul').html(specHtml);var dataId=$('.details-Specifications-size').find('li').first().find('a').attr('data-productid');$('#markupPro').attr('data-productid',dataId);fuc.detailsScroll();},specHtml:function(product){var specHtml='';var specHtmlOptions='';if(product.img_url!==undefined&&product.img_url!==''&&product.has_spec_img){var imgSrc=product.img_url;if(detailCache.getType()=='multiply'){imgSrc=detailCache.getGlobalSpecImg();}
specHtml+='<img src="'+Global.staticDomain+imgSrc+'" class="details-img">';specHtmlOptions+='<ul class="details-options fl-left">';}else{specHtmlOptions+='<ul class="details-options child-fl">';$('.details-price').css({'left':'2px','top':'75px'})
$('.details-img-box').css('min-height','66px')}
if(product.pound=='more'){if(product.img_url!==undefined&&product.img_url!==''&&product.has_spec_img){specHtml+='<div class="more-number">需订购“更多磅数”，请与客服人员联系。<span>订购电话：400 650 2121</span></div>';}else{specHtml+='<div class="more-number-img">需订购“更多磅数”，请与客服人员联系。<span>订购电话：400 650 2121</span></div>';}
return specHtml;}
if(product.size!==undefined&&product.size!==''){specHtmlOptions+='<li class="details-options-size"><i></i>'+product.size+'</li>';}
if(product.suite_amount!==undefined&&product.suite_amount!==''){specHtmlOptions+='<li class="details-options-unmber"><i></i>'+product.suite_amount+'</li>';}
if(product.cutlery_content!==undefined&&product.cutlery_content!==''){specHtmlOptions+='<li class="details-options-laid"><i></i>'+product.cutlery_content+'</li>';}
if(product.booking_hour_limited!==undefined&&product.booking_hour_limited!==''&&product.booking_hour_limited!=0){specHtmlOptions+='<li class="details-options-time"><i></i></li>';}
specHtmlOptions+='</ul>';return specHtml+specHtmlOptions;},cartWaitHtml:function(){var cartWaitHtml='';cartWaitHtml+='<div class="addcart-success">';cartWaitHtml+='<span></span>';cartWaitHtml+='</div>';return cartWaitHtml;},cartSuccessHtml:function(url){var html='';html+='<div class="addcart-success">';html+='<div>';html+='<p><i></i>成功添加购物车</p>';html+='<a href="'+url+'" class="details-go-cart">查看购物车</a>';html+='</div>';html+='</div>';return html;},getDefault:function(){var reg=new RegExp('(?:\\?|&)default=(.*?)(?=&|$)','gi');var result=null;var m=reg.exec(document.location.search);if(m!=null){return m[1];}
return null;},changeUrl:function(productPound){if(!productPound){return false;}
try{window.history.pushState({},0,window.location.origin+window.location.pathname+'?default='+productPound);}catch(e){}},getDefaultGoods:function(){var reg=new RegExp('(?:\\?|&)defaultGoods=(.*?)(?=&|$)','gi');var result=null;var m=reg.exec(document.location.search);if(m!=null){return m[1];}
return $('input[name=goodsId]').val();;}};var sweetness=$('.distribution-sweet').attr('data-sweet');var sweetnessList=$('.distribution-sweet span.sweet-icon i');$.each(sweetnessList,function(index,val){if(index<sweetness){$(this).addClass('active');}});window.onload=function(){if(!window.applicationCache){$('#videoButton').hide();}}
var ended=false;$('#videoButton').click(function(){$('#videoButton').find('.play').addClass('hidden').hide();$('#videoButton').find('.loading').show();var url=$('#otherImg').attr('src');var vodeoUrl=$(this).attr('data-video');$('.video-box').append('<video id="video" src="'+Global.mediaDomain+vodeoUrl+'"\
        poster="'+url+'" preload="auto"\
         autoplay    style="width:100%;">\
             <img src="'+url+'">\
            </video>')
loadEvent();video.addEventListener('ended',function(){ended=true;$('#videoButton,#videoButton .play,#otherImg').show();$('#videoButton').find('.play').removeClass('hidden')
$('#videoButton .loading,.pause').hide();$('video').hide();$('#videoButton').unbind('click').on('click',function(){loadEvent();ended=false;})},false);});$('#bannerImgList li').mouseenter(function(){if($(this).hasClass('video-list')){return false;}
var url=$(this).data('url');$('#videoButton').hide();$('#otherImg').attr('src',url).show();$('.pause').hide();if(document.getElementById("video")&&document.getElementById("video").currentTime.toFixed(1)>0){document.getElementById("video").pause();$('.pause').css('background-image',"url(/themes/site/img/video.png)");}
$(this).addClass('active').siblings('li').removeClass('active');});$('#bannerImgList li.video-list').mouseenter(function(){var url=$(this).data('url');$('#otherImg').attr('src',url).show();var vodeoUrl=$(this).data('video');$('#videoButton').attr('data-video',vodeoUrl).show();if(document.getElementById("video")&&document.getElementById("video").currentTime.toFixed(1)>0){if(!ended){$('.pause').show();$('#otherImg').hide();$('#videoButton').hide();}}else{$('#videoButton').show();}
if($('#videoButton img').hasClass('hidden')){$('.pause').show();}
$(this).addClass('active').siblings('li').removeClass('active');});$('#bannerImgList li').first().trigger('mouseenter')
$('.pause').click(function(){if(video.paused){video.play()
$('.pause').css('background-image',"url(/themes/site/img/video2.png)");}else{video.pause();$('#videoButton').hide();$('.pause').css('background-image',"url(/themes/site/img/video.png)");}});function loadEvent(){$('video').show();$('#otherImg').hide();var video=document.getElementById("video");video.play();video.volume=0;$('.pause').show()
var t=setInterval(function(){if(document.getElementById("video").readyState==4){$('#videoButton').hide();clearInterval(t)}},500)}});